<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Team - {{ team.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='script/script.js') }}"></script>
</head>
<body>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-container">
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<h1>Manage Team: {{ team.name }}</h1>
<p><strong>Description:</strong> {{ team.description }}</p>
<p><strong>Leader:</strong> {{ team.leader_name }}</p>

<hr>

<h2>Team Members</h2>
{% if members %}
<table border="1" cellpadding="6">
    <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>
    {% for member in members %}
    <tr>
        <td>{{ member.username }}</td>
        <td>{{ member.email }}</td>
        <td>{{ member.role }}</td>
        <td>{{ member.status }}</td>
        <td>
            <form method="POST" action="{{ url_for('teamLeader_mainpage_bp.remove_member', team_id=team_id) }}" style="display:inline;">
                <input type="hidden" name="email" value="{{ member.email }}">
                <button type="submit" onclick="return confirm('Remove this member?');">Remove</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No members yet.</p>
{% endif %}

<h3>Add New Member</h3>
<form method="POST" action="{{ url_for('teamLeader_mainpage_bp.add_member', team_id=team_id) }}">
    <label for="member_email">Member Email:</label>
    <input type="email" id="member_email" name="member_email" required>
    <button type="submit">Add Member</button>
</form>

<hr>

<h2>Team Tasks</h2>
<div id="tasksContainer">
{% if tasks %}
<table border="1" cellpadding="6">
    <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Assigned To</th>
        <th>Status</th>
        <th>Priority</th>
        <th>Due Date</th>
        <th>Actions</th>
    </tr>
    {% for task in tasks %}
    <tr>
        <td>{{ task.title }}</td>
        <td>{{ task.description }}</td>
        <td>{{ task.assigned_to }}</td>
        <td>{{ task.status }}</td>
        <td>{{ task.priority }}</td>
        <td>{{ task.due_date }}</td>
        <td>
            <button 
                type="button" 
                data-url="{{ url_for('teamLeader_mainpage_bp.view_task', task_id=task.task_id) }}" 
                onclick="window.location.href=this.dataset.url;">
                View
            </button>

            <button 
                type="button" 
                data-url="{{ url_for('teamLeader_mainpage_bp.edit_task', task_id=task.task_id) }}" 
                onclick="window.location.href=this.dataset.url;">
                Edit
            </button>
            <form method="POST" action="{{ url_for('teamLeader_mainpage_bp.delete_task', task_id=task.task_id) }}" style="display:inline;">
                <button type="submit" onclick="return confirm('Delete this task?');">Delete</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No tasks found for this team.</p>
{% endif %}
</div>

<h3>Create New Task</h3>
<form method="POST" action="{{ url_for('teamLeader_mainpage_bp.create_task', team_id=team_id) }}">
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required><br><br>

    <label for="description">Description:</label>
    <textarea id="description" name="description" required></textarea><br><br>

    <label for="assigned_to">Assign To (email):</label>
    <input type="email" id="assigned_to" name="assigned_to" required><br><br>

    <label for="priority">Priority:</label>
    <select id="priority" name="priority" required>
        <option value="Low">Low</option>
        <option value="Medium">Medium</option>
        <option value="High">High</option>
    </select><br><br>

    <label for="due_date">Due Date:</label>
    <input type="date" id="due_date" name="due_date"><br><br>

    <button type="submit">Create Task</button>
</form>

<hr>
<button onclick='window.location.href="/teamLeader-manageTeams";'>â¬… Back to My Teams</button>
</body>
</html>
